TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`%` TRIGGER `update_kondisi_jantung` BEFORE INSERT ON `db_jantung` FOR EACH ROW BEGIN\n    DECLARE umur_pasien INT;  -- Semicolon added here\n    DECLARE kategori VARCHAR(20);\n    DECLARE pelan, normal, cepat, rendah, tinggi DECIMAL(5,2);\n    DECLARE z_pelan_rendah, z_pelan_tinggi DECIMAL(5,2);\n    DECLARE z_normal_rendah, z_normal_tinggi DECIMAL(5,2);\n    DECLARE z_cepat_rendah, z_cepat_tinggi DECIMAL(5,2);\n    DECLARE z_total, sum_weights, z_crips DECIMAL(5,2);\n\n    -- Ambil nilai Umur dari tabel users berdasarkan ID pasien\n    SELECT umur INTO umur_pasien FROM users WHERE id = NEW.id_pasien;\n\n    -- Menentukan kategori umur\n    IF umur_pasien < 2 THEN\n        SET kategori = \'BAYI\';\n        SET NEW.Kategori = \'BAYI\';\n    ELSEIF umur_pasien BETWEEN 2 AND 15 THEN\n        SET kategori = \'ANAK\';\n        SET NEW.Kategori = \'ANAK\';\n    ELSEIF umur_pasien BETWEEN 15 AND 100 THEN\n        SET kategori = \'DEWASA\';\n        SET NEW.Kategori = \'DEWASA\';\n    END IF;\n\n    -- Fuzzifikasi Detak Jantung\n    -- Bayi (0 - 2 tahun)\n    IF kategori = \'BAYI\' THEN\n        SET pelan = CASE \n            WHEN NEW.DetakJantung <= 80 THEN 1\n            WHEN NEW.DetakJantung > 80 AND NEW.DetakJantung < 85 THEN (85 - NEW.DetakJantung) / 5\n            ELSE 0\n        END;\n        \n        SET normal = CASE\n            WHEN NEW.DetakJantung > 80 AND NEW.DetakJantung <= 85 THEN (NEW.DetakJantung - 80) / 5\n            WHEN NEW.DetakJantung > 85 AND NEW.DetakJantung <= 120 THEN 1\n            WHEN NEW.DetakJantung > 120 AND NEW.DetakJantung < 140 THEN (140 - NEW.DetakJantung) / 20\n            ELSE 0\n        END;\n        \n        SET cepat = CASE\n            WHEN NEW.DetakJantung >= 120 AND NEW.DetakJantung <= 140 THEN (NEW.DetakJantung - 120) / 20\n            WHEN NEW.DetakJantung > 140 THEN 1\n            ELSE 0\n        END;\n    -- Anak (2 - 15 tahun)\n    ELSEIF kategori = \'ANAK\' THEN\n        SET pelan = CASE \n            WHEN NEW.DetakJantung <= 70 THEN 1\n            WHEN NEW.DetakJantung > 70 AND NEW.DetakJantung < 75 THEN (75 - NEW.DetakJantung) / 5\n            ELSE 0\n        END;\n        \n        SET normal = CASE\n            WHEN NEW.DetakJantung > 70 AND NEW.DetakJantung <= 75 THEN (NEW.DetakJantung - 70) / 5\n            WHEN NEW.DetakJantung > 75 AND NEW.DetakJantung <= 95 THEN 1\n            WHEN NEW.DetakJantung > 95 AND NEW.DetakJantung < 110 THEN (110 - NEW.DetakJantung) / 15\n            ELSE 0\n        END;\n        \n        SET cepat = CASE\n            WHEN NEW.DetakJantung >= 95 AND NEW.DetakJantung <= 110 THEN (NEW.DetakJantung - 95) / 15\n            WHEN NEW.DetakJantung > 110 THEN 1\n            ELSE 0\n        END;\n    -- Dewasa (15 - 100 tahun)\n    ELSEIF kategori = \'DEWASA\' THEN\n        SET pelan = CASE \n            WHEN NEW.DetakJantung <= 60 THEN 1\n            WHEN NEW.DetakJantung > 60 AND NEW.DetakJantung < 65 THEN (65 - NEW.DetakJantung) / 5\n            ELSE 0\n        END;\n        \n        SET normal = CASE\n            WHEN NEW.DetakJantung > 60 AND NEW.DetakJantung <= 65 THEN (NEW.DetakJantung - 60) / 5\n            WHEN NEW.DetakJantung > 65 AND NEW.DetakJantung <= 90 THEN 1\n            WHEN NEW.DetakJantung > 90 AND NEW.DetakJantung < 100 THEN (100 - NEW.DetakJantung) / 10\n            ELSE 0\n        END;\n        \n        SET cepat = CASE\n            WHEN NEW.DetakJantung >= 90 AND NEW.DetakJantung <= 100 THEN (NEW.DetakJantung - 90) / 10\n            WHEN NEW.DetakJantung > 100 THEN 1\n            ELSE 0\n        END;\n    END IF;\n\n    -- Fuzzifikasi Saturasi Oksigen\n    SET rendah = CASE\n        WHEN NEW.SaturasiOksigen < 95 THEN 1\n        ELSE 0\n    END;\n\n    SET tinggi = CASE\n        WHEN NEW.SaturasiOksigen >= 95 AND NEW.SaturasiOksigen <= 100 THEN 1\n        ELSE 0\n    END;\n\n    -- Implementasi Aturan Tsukamoto dan perhitungan z (nilai keluaran)\n    SET z_pelan_rendah = LEAST(pelan, rendah) * 30; -- \'Tidak Normal\'\n    SET z_pelan_tinggi = LEAST(pelan, tinggi) * 30; -- \'Tidak Normal\'\n    SET z_normal_rendah = LEAST(normal, rendah) * 50; -- \'Kurang Normal\'\n    SET z_normal_tinggi = LEAST(normal, tinggi) * 70; -- \'Normal\'\n    SET z_cepat_rendah = LEAST(cepat, rendah) * 70; -- \'Normal\'\n    SET z_cepat_tinggi = LEAST(cepat, tinggi) * 70; -- \'Normal\'\n\n    -- Hitung total z dan sum_weights\n    SET z_total = z_pelan_rendah + z_pelan_tinggi +\n                  z_normal_rendah + z_normal_tinggi +\n                  z_cepat_rendah + z_cepat_tinggi;\n\n    SET sum_weights = (LEAST(pelan, rendah) + LEAST(pelan, tinggi) +\n                       LEAST(normal, rendah) + LEAST(normal, tinggi) +\n                       LEAST(cepat, rendah) + LEAST(cepat, tinggi));\n\n    -- Defuzzifikasi menggunakan rata-rata berbobot\n    IF sum_weights > 0 THEN\n        SET z_crips = z_total / sum_weights;\n    ELSE\n        SET z_crips = 0; -- Default jika tidak ada keanggotaan\n    END IF;\n    \n    -- Simpan hasil defuzzifikasi\n    SET NEW.z_crips = z_crips;\n\n    -- Kategorisasi hasil defuzzifikasi\n    IF z_crips < 40 THEN\n        SET NEW.KondisiJantung = \'TIDAK NORMAL\';\n    ELSEIF z_crips BETWEEN 40 AND 60 THEN\n        SET NEW.KondisiJantung = \'KURANG NORMAL\';\n    ELSE\n        SET NEW.KondisiJantung = \'NORMAL\';\n    END IF;\nEND'
sql_modes=524288
definers='root@%'
client_cs_names='utf8mb4'
connection_cl_names='utf8mb4_uca1400_ai_ci'
db_cl_names='utf8mb4_uca1400_ai_ci'
created=1746173339308710
