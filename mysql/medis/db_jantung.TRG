TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`%` TRIGGER `fuzzy_trigger` BEFORE INSERT ON `db_jantung` FOR EACH ROW BEGIN\n  DECLARE umur_pasien INT;\n  DECLARE μ_umur_bayi, μ_umur_anak, μ_umur_dewasa DOUBLE;\n  DECLARE μ_dj_pelan, μ_dj_normal, μ_dj_cepat DOUBLE;\n  DECLARE μ_so_rendah, μ_so_normal DOUBLE;\n  DECLARE α, z, sum_α_z, sum_α DOUBLE;\n  DECLARE i INT;\n\n  SELECT umur INTO umur_pasien FROM users WHERE id = NEW.id_pasien;\n\n    -- Fuzzyfikasi Umur\n    IF umur_pasien <= 1 THEN\n        SET μ_umur_bayi = 1;\n    ELSEIF umur_pasien > 1 AND umur_pasien < 2 THEN\n        SET μ_umur_bayi = 1 / (2 - umur_pasien);\n    ELSE\n        SET μ_umur_bayi = 0;\n    END IF;\n\n    IF umur_pasien >= 1 AND umur_pasien <= 2 THEN\n        SET μ_umur_anak = 1 / (2 - 1);\n    ELSEIF umur_pasien > 2 AND umur_pasien <= 15 THEN\n        SET μ_umur_anak = (15 - umur_pasien) / (15 - 2);\n    ELSE\n        SET μ_umur_anak = 0;\n    END IF;\n\n    IF umur_pasien <= 2 THEN\n        SET μ_umur_dewasa = 0;\n    ELSEIF umur_pasien > 2 AND umur_pasien < 15 THEN\n        SET μ_umur_dewasa = (umur_pasien - 2) / (15 - 2);  -- Fixed to match μDEWASA[x] = (x-b)/(c-b)\n    ELSE\n        SET μ_umur_dewasa = 1;\n    END IF;\n\n    -- Tentukan kategori umur berdasarkan nilai keanggotaan tertinggi\n    IF μ_umur_bayi >= μ_umur_anak AND μ_umur_bayi >= μ_umur_dewasa THEN\n        SET NEW.Kategori = \'BAYI\';\n    ELSEIF μ_umur_anak >= μ_umur_bayi AND μ_umur_anak >= μ_umur_dewasa THEN\n        SET NEW.Kategori = \'ANAK\';\n    ELSE\n        SET NEW.Kategori = \'DEWASA\';\n    END IF;\n\n    -- Fuzzyfikasi Detak Jantung\n    IF NEW.DetakJantung <= 55 THEN\n        SET μ_dj_pelan = 1;\n    ELSEIF NEW.DetakJantung > 55 AND NEW.DetakJantung < 60 THEN\n        SET μ_dj_pelan = (60 - NEW.DetakJantung) / (60 - 55);  -- Fixed to match μPELAN[x] = 1/(60-55) for 55≤x≤60\n    ELSE\n        SET μ_dj_pelan = 0;\n    END IF;\n\n    IF NEW.DetakJantung >= 55 AND NEW.DetakJantung <= 60 THEN\n        SET μ_dj_normal = (NEW.DetakJantung - 55) / (60 - 55);  -- Fixed to match μNORMAL[x] = (x-55)/(60-55)\n    ELSEIF NEW.DetakJantung > 60 AND NEW.DetakJantung <= 100 THEN\n        SET μ_dj_normal = (100 - NEW.DetakJantung) / (100 - 60);  -- Fixed to match μNORMAL[x] = (100-x)/(100-60)\n    ELSE\n        SET μ_dj_normal = 0;\n    END IF;\n\n    IF NEW.DetakJantung <= 60 THEN\n        SET μ_dj_cepat = 0;\n    ELSEIF NEW.DetakJantung > 60 AND NEW.DetakJantung < 100 THEN\n        SET μ_dj_cepat = (NEW.DetakJantung - 60) / (100 - 60);  -- Fixed to match μCEPAT[x] = (x-60)/(100-60)\n    ELSE\n        SET μ_dj_cepat = 1;\n    END IF;\n\n    -- Fuzzyfikasi Saturasi Oksigen\n    IF NEW.SaturasiOksigen <= 90 THEN\n        SET μ_so_rendah = 1;\n    ELSEIF NEW.SaturasiOksigen > 90 AND NEW.SaturasiOksigen < 95 THEN\n        SET μ_so_rendah = (95 - NEW.SaturasiOksigen) / (95 - 90);  -- Fixed to match μRENDAH[x] = (95-x)/(95-90)\n    ELSE\n        SET μ_so_rendah = 0;\n    END IF;\n\n    IF NEW.SaturasiOksigen <= 90 THEN\n        SET μ_so_normal = 0;\n    ELSEIF NEW.SaturasiOksigen > 90 AND NEW.SaturasiOksigen < 95 THEN\n        SET μ_so_normal = (NEW.SaturasiOksigen - 90) / (95 - 90);  -- Fixed to match μNORMAL[x] = (x-90)/(95-90)\n    ELSE\n        SET μ_so_normal = 1;\n    END IF;\n\n  -- Inisialisasi defuzzifikasi\n  SET sum_α = 0;\n  SET sum_α_z = 0;\n\n    -- Rule 1: Bayi, Pelan, Rendah → Tidak Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_pelan, μ_so_rendah);\n    SET z = 40;  -- Nilai crisp untuk Tidak Normal\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 2: Bayi, Pelan, Normal → Kurang Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_pelan, μ_so_normal);\n    SET z = 50;  -- Nilai crisp untuk Kurang Normal\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 3: Bayi, Normal, Rendah → Kurang Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_normal, μ_so_rendah);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 4: Bayi, Normal, Normal → Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_normal, μ_so_normal);\n    SET z = 70;  -- Nilai crisp untuk Normal\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 5: Bayi, Cepat, Rendah → Tidak Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_cepat, μ_so_rendah);\n    SET z = 40;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 6: Bayi, Cepat, Normal → Kurang Normal\n    SET α = LEAST(μ_umur_bayi, μ_dj_cepat, μ_so_normal);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 7: Anak, Pelan, Rendah → Tidak Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_pelan, μ_so_rendah);\n    SET z = 40;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 8: Anak, Pelan, Normal → Kurang Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_pelan, μ_so_normal);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 9: Anak, Normal, Rendah → Kurang Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_normal, μ_so_rendah);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 10: Anak, Normal, Normal → Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_normal, μ_so_normal);\n    SET z = 70;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 11: Anak, Cepat, Rendah → Kurang Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_cepat, μ_so_rendah);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 12: Anak, Cepat, Normal → Normal\n    SET α = LEAST(μ_umur_anak, μ_dj_cepat, μ_so_normal);\n    SET z = 70;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 13: Dewasa, Pelan, Rendah → Tidak Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_pelan, μ_so_rendah);\n    SET z = 40;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 14: Dewasa, Pelan, Normal → Kurang Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_pelan, μ_so_normal);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 15: Dewasa, Normal, Rendah → Kurang Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_normal, μ_so_rendah);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 16: Dewasa, Normal, Normal → Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_normal, μ_so_normal);\n    SET z = 70;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 17: Dewasa, Cepat, Rendah → Kurang Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_cepat, μ_so_rendah);\n    SET z = 50;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n    -- Rule 18: Dewasa, Cepat, Normal → Normal\n    SET α = LEAST(μ_umur_dewasa, μ_dj_cepat, μ_so_normal);\n    SET z = 70;\n    SET sum_α_z = sum_α_z + α * z;\n    SET sum_α = sum_α + α;\n\n  -- Defuzzifikasi\n  IF sum_α > 0 THEN\n    SET NEW.z_crips = sum_α_z / sum_α;\n  ELSE\n    SET NEW.z_crips = 0;\n  END IF;\n\n  -- Penentuan kondisi kesehatan berdasarkan z_crips\n    IF NEW.z_crips < 55 THEN\n        SET NEW.KondisiJantung = \'Tidak Normal\';\n    ELSEIF NEW.z_crips >= 55 AND NEW.z_crips < 65 THEN\n        SET NEW.KondisiJantung = \'Kurang Normal\';\n    ELSE\n        SET NEW.KondisiJantung = \'Normal\';\n    END IF;\n\nEND'
sql_modes=1411383296
definers='root@%'
client_cs_names='utf8mb4'
connection_cl_names='utf8mb4_unicode_ci'
db_cl_names='utf8mb4_uca1400_ai_ci'
created=1746507943127118
